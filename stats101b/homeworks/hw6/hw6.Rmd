---
title: "Homework 6"
output: pdf_document
---

\begin{center}
Earle Aguilar \\
804501476 \\
2017-02-24
\end{center}


```{r, echo=F}
halfnormalplot <- function(y, label=F, n=length(y), fac.names=NULL,
                           xlim=c(-.1, 2.5), main="Half-Normal Plot", 
                           ...)
  { # label the most singificant n effects 
    m <- length(y)
    x <- seq(0.5+0.25/m, 1.0-0.25/m, by=0.5/m)
    x <-  qnorm(x)
    y <-  sort(abs(y))
    qqplot(x, y, xlab="half-normal quantiles", ylab="absolute effects",
           xlim=xlim, main=main, ...)
    if(is.null(fac.names)) fac.names <-  names(y)
    else fac.names <-  rev( c(fac.names, rep("", length(y)-length(fac.names)) ) )
    if(label) for(i in (m-n+1):m) text(x[i]+.1,y[i], fac.names[i], cex=0.8)  
}

as.level2 = function(x){
  y = rep(0, length(x))
  y[x == levels(x)[1]] <- -1
  y[x == levels(x)[2]] <-  1
  y
}
```

\section{6.17}
```{r}
effects <- c("A","B","C","D","AB","AC","AD","BC",
             "BD","CD","ABC","ABD","ACD","BCD","ABCD")
values <- c(76.95,-67.52,-7.84,-18.73,-51.32,
            11.69,9.78,20.78,14.74,1.27,-2.82,
            -6.5,10.2,-7.98,-6.25)
df1 <- data.frame(effects, values)
```
\subsection{a}
```{r}
data_sort <- df1[order(df1$value),]
x <- qqnorm(data_sort$values)[1]$x
qqnorm(data_sort$values, xlim=c(-2,2))
text(sort(x), data_sort$values+4, labels=data_sort$effects, cex=0.6)
```

\subsection{b}
The effects A, B, and AB are significant according to the Normal QQ plot. Therefore a model could include these effects only.

```{r}
beta_A  <- df1$values[df1$effects == "A"]  / 2
beta_B  <- df1$values[df1$effects == "B"]  / 2
beta_AB <- df1$values[df1$effects == "AB"] / 2
```

\section{6.24}
```{r}
library(readxl)
df <- read_excel("~/vmshare/stats 101b datasets/Chapter 6 (P.24).xlsx")
#read_excel("/Users/Earle/Downloads/Chapter 6 (P.24).xlsx")
df$Class <- as.factor(df$Class)
df$Type  <- as.factor(df$Type)
df$Price <- as.factor(df$Price)
A <- -as.level2(df$Class)
B <- as.level2(df$Type)
C <- as.level2(df$Price)

df2 <- cbind(A,B,C,Number_of_orders=df$`Number of Orders` )
df2 <- as.data.frame(df2)
```

\subsection{a}
The factors which are significant are C, AB, AC, BC with p-values: $0.0085163$, $0.0056019$, $0.0004176$, and $0.0037282$ respectively.
```{r}
m <- lm(Number_of_orders ~ A*B*C,df2)
anova(m)
```
\subsection{b}
The residual plot does not show any indication of non-constant variance. The normal Q-Q plot shows that the residuals are not following the normal distribution.
```{r}
par(mfrow=c(2,2))
m <- lm(Number_of_orders ~ C + A*B + A*C + B*C,df2)
plot(m,1:2)
```
\subsection{c}
According to the interaction plots, If we need to use the price of $\$19.95$ the I recommend $3^{rd}$ class mail with black and white brochures. However if we need to use price $\$24.95$ then I recommend $1^{st}$ class mail with color brochures.
```{r}
par(mfrow=c(2,2))
interaction.plot(df2$A,df2$B,df2$Number_of_orders,
                 xlab = "A: Class", ylab="Number of Orders",
                 trace.label = "B: Type",col=c("red", "black"))

interaction.plot(df2$A,df2$C,df2$Number_of_orders,
                 xlab = "A: Class", ylab="Number of Orders",
                 trace.label = "C: Price",col=c("red", "black"))

interaction.plot(df2$B,df2$C,df2$Number_of_orders,
                 xlab = "B: Type", ylab="Number of Orders",
                 trace.label = "C: Price",col=c("red", "black"))
```
\section{6.30} 
```{r}
library(readxl)
#df <-  read_excel("/Users/Earle/Downloads/Test_book_prob.xlsx")
df <- read_excel("~/vmshare/stats 101b datasets/Ch6(P30).xlsx")
df$`Pan Material` <- as.factor(df$`Pan Material`)
df$`Stirring Method` <- as.factor(df$`Stirring Method`)
df$`Mix Brand` <- as.factor(df$`Mix Brand`)
A <- -as.level2(df$`Pan Material`)
B <- -as.level2(df$`Stirring Method`)
C <- -as.level2(df$`Mix Brand`)

df2 <- cbind(A,B,C,Scrumptiousness = df$Scrumptiousness)
df2 <- as.data.frame(df2)
```
\subsection{a)}

The ANOVA indicates that the most significant factor is the pan matrial. Creating model with this we see that a glass pan plays the significant role in scrumptiousness.

```{r}
m <- lm(Scrumptiousness ~ A*B*C, df2)
anova(m)
m <- lm(Scrumptiousness ~ A, df2)
summary(m)
```
\subsection{b)}

No we do not have 8 replicates, each tester is tasting the same brownie. The appropriate method is to use the probability plots to determine which is significant.

\subsection{c)}

\textbf{Average:}

Factors A and B affect the mean of scrumptiousness. 

```{r}
m <- lm(Scrumptiousness ~ A*B*C, df2)
effects <- m$coefficients[-1]*2
xy <- cbind(model.matrix(m)[,-1], scrumptiousness = df2$Scrumptiousness)

xy_avg <- matrix(nrow =8, ncol = 8)
colnames(xy_avg) <- colnames(xy)
for(i in 1:8){
  xy_avg[i, 1:7] <- print(xy[(i-1)*8+1,1:7])
  xy_avg[i, 8] <- mean(xy[ ((i-1)*8+1):((i-1)*8+8) ,8] )
} 
xy_avg <- as.data.frame(xy_avg)

A <- xy_avg$A
B <- xy_avg$B
C <- xy_avg$C

m <- lm(xy_avg$scrumptiousness ~ A*B*C)

halfnormalplot(m$effects[-1], label=T)
```
\textbf{Standard Deviation:}
Factors AC and C affect the standard deviations of scrumptiousness.

```{r}
xy_sd <- matrix(nrow =8, ncol = 8)
colnames(xy_sd) <- colnames(xy)
for(i in 1:8){
  xy_sd[i, 1:7] <- print(xy[(i-1)*8+1,1:7])
  xy_sd[i, 8] <- sd(xy[ ((i-1)*8+1):((i-1)*8+8) ,8] )
}
xy_sd <- as.data.frame(xy_sd)

A <- xy_sd$A
B <- xy_sd$B 
C <- xy_sd$C

m <- lm(xy_sd$scrumptiousness ~ A*B*C)

halfnormalplot(m$effects[-1], label=T)
```
\section{6.35}
```{r}
#df4 <- read_excel("/Users/Earle/Downloads/Chapter6_p35.xlsx")
df <- read_excel("~/vmshare/stats 101b datasets/CH6(P35).xlsx")
df$`Tool Angle` <- as.factor(df$`Tool Angle`)
df$Viscosity <- as.factor(df$Viscosity)
df$`Feet Rate` <- as.factor(df$`Feet Rate`)
df$`Cutting Fluid` <- as.factor(df$`Cutting Fluid`)

A <- as.level2(df$`Tool Angle`)
B <- as.level2(df$Viscosity)
C <- as.level2(df$`Feet Rate`)
D <- as.level2(df$`Cutting Fluid`)

df2 <- cbind(A,B,C,D, surface_roughness = df$`Surface Roughness`)
df2 <- as.data.frame(df2)
```

\subsection{a}
The half normal probability indicates that A, B, C, and AB significant.
```{r}
m <- lm(surface_roughness ~ A*B*C*D,df2)
halfnormalplot(m$effects[2:16],label=T)
```
\subsection{b}
The residual plot show a trend line which is an indication of non-constant variance. The normal QQ plot shows that the resiuals are approximately following the normal distribution.
```{r}
par(mfrow=c(2,2))
m <- lm(surface_roughness ~ A + B + C + A*B ,df2)
anova(m)
plot(m,1:2)
```
\subsection{c}
The transformation eliminated the trend line that was present in the earlier untransformed analysis. It also made the residuals follow the normal distribution more closely.
```{r}
par(mfrow=c(2,2))
m <- lm(1/surface_roughness ~ A*B*C*D, df2)
halfnormalplot(m$effects[2:16],label=T)


m <- lm(1/surface_roughness ~ A+B+C+A*B, df2)
anova(m)
plot(m,1:2)
```
\subsection{d}
$$\frac{1}{Surface \ Roughness} = 397.81 + 51.61 A + 74.74B + 34.24 C +58.70 AB$$
\section{6.45}
\begin{align}
2*\hat{\beta} \pm t_{\frac{\alpha}{2}, df_E} \times se(\hat{\beta})*2 \le 1.5 \\
2*\hat{\beta} \pm t_{\frac{\alpha}{2}, df_E} \times \sqrt{V(2\hat{\beta})} *2 \le 1.5 \\
2*\hat{\beta} \pm t_{\frac{\alpha}{2}, df_E} \times \sqrt{4V(\hat{\beta})} *2 \le 1.5 \\
2*\hat{\beta} \pm t_{\frac{\alpha}{2}, df_E} \times 2*\sqrt{\frac{\sigma^2}{n*2^k}} *2 \le 1.5 \\
2*\hat{\beta} \pm t_{\frac{\alpha}{2}, df_E} \times 4*\sqrt{\frac{1}{2n}} \le 1.5 \\
2*\hat{\beta} \pm t_{0.975, 8n-8} \times \sqrt{\frac{8}{n}} \le 1.5 \\
\end{align}

\section{7.14}
Since we have two replicates then we should have two block, one for each replicate.








