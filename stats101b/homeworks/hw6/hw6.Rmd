---
title: "Homework 6"
output: pdf_document
---

I found this half-normal quantile plot written by professor TODO
```{r}
halfnormalplot <- function(y, label=F, n=length(y), fac.names=NULL,
                           xlim=c(-.1, 2.5), main="Half-Normal Plot",l_pos, 
                           ...)
  { # label the most singificant n effects 
    m <- length(y)
    x <- seq(0.5+0.25/m, 1.0-0.25/m, by=0.5/m)
    x <-  qnorm(x)
    y <-  sort(abs(y))
    qqplot(x, y, xlab="half-normal quantiles", ylab="absolute effects",
           xlim=xlim, main=main, ...)
    if(is.null(fac.names)) fac.names <-  names(y)
    else fac.names <-  rev( c(fac.names, rep("", length(y)-length(fac.names)) ) )
    if(label) for(i in (m-n+1):m) text(x[i]+.2,y[i], fac.names[i], pos=l_pos)  
  }
```

\section{6.17}
```{r}
effects <- c("A","B","C","D","AB","AC","AD","BC",
             "BD","CD","ABC","ABD","ACD","BCD","ABCD")
values <- c(76.95,-67.52,-7.84,-18.73,-51.32,
            11.69,9.78,20.78,14.74,1.27,-2.82,
            -6.5,10.2,-7.98,-6.25)
df1 <- data.frame(effects, values)
```
\subsection{a}
```{r}
qqnorm(df1$values)
qqline(df1$values)
```

\subsection{b}
The effects A, B, and AB are significant according to the Normal QQ plot. Therefore a model could include these effects only.

\section{6.24}
```{r}
A <- c("3rd","3rd","1st","1st","3rd","3rd","1st",
       "1st","3rd","3rd","1st","1st","3rd","3rd",
       "1st","1st")

B <- c("BW","BW","BW","BW","Color","Color","Color",
       "Color","BW","BW","BW","BW","Color","Color",
       "Color","Color")

C <- c(19.95,19.95,19.95,19.95,19.95,19.95,19.95,
       19.95,24.95,24.95,24.95,24.95,24.95,24.95,
       24.95,24.95)
C <- as.factor(C)

Number_of_Orders <- c(50,54,44,42,46,48,42,43,49,
                      46,48,45,47,48,56,54) 

df2 <- data.frame(A, B, C, Number_of_Orders)

options(contrasts=c("contr.sum","contr.poly"))

```

\subsection{a}
The factors which are significant are C, AB, AC, BC with p-values: $0.0085163$, $0.0056019$, $0.0004176$, and $0.0037282$ respectively.
```{r}
m <- lm(Number_of_Orders ~ A*B*C,df2)
anova(m)

#par(mfrow=c(2,2))
halfnormalplot(m$effects[2:8],label=T, l_pos=2)
qqline(m$effects[2:8])

```
\subsection{b}
The residual plot does not show any indication of non-constant variance. The normal Q-Q plot shows that the residuals are not following the normal distribution.
```{r}
#par(mfrow=c(2,2))
m <- lm(Number_of_Orders ~ C + A*B + A*C + B*C,df2)
plot(m,1:2)
```
\subsection{c}
According to the interaction plots, I recommend $3^{rd}$ class mail with black and white brochures, and a price of $\$19.95$ this would create the highest number of orders.
```{r}
#par(mfrow=c(2,2))
interaction.plot(df2$A,df2$B,df2$Number_of_Orders,
                 xlab = "A: Class", ylab="Number of Orders",
                 trace.label = "B: Type",col=c("red", "black"))
interaction.plot(df2$A,df2$C,df2$Number_of_Orders,
                 xlab = "A: Class", ylab="Number of Orders",
                 trace.label = "C: Price",col=c("red", "black"))
interaction.plot(df2$B,df2$C,df2$Number_of_Orders,
                 xlab = "B: Type", ylab="Number of Orders",
                 trace.label = "C: Price",col=c("red", "black"))
```
\section{6.30} 
```{r}
library(readxl)
df3 <-  read_excel("/Users/Earle/Downloads/Test_book_prob.xlsx")
names(df3) <- c("A", "B", "C", "Scrumptiousness")
df3$A <- as.factor(df3$A)
df3$B <- as.factor(df3$B)
df3$C <- as.factor(df3$C)
```
\subsection{a)}

The ANOVA indicates that the most significant factor is the pan matrial. Creating model with this we see that a glass pan plays the significant role in scrumptiousness.

```{r}
m <- lm(Scrumptiousness ~ A*B*C, df3)
anova(m)
m <- lm(Scrumptiousness ~ A, df3)
summary(m)
```
\subsection{b)}
\subsection{c)}
\section{6.35}
```{r}
df4 <- read_excel("/Users/Earle/Downloads/Chapter6_p35.xlsx")
names(df4) <- c("A","B","C","D","Surface_Roughness")
df4$A <- as.factor(df4$A)
df4$B <- as.factor(df4$B)
df4$C <- as.factor(df4$C)
df4$D <- as.factor(df4$D)

```

\subsection{a}
The half normal probability indicates that A, B, C, and AB significant.
```{r}
options(contrasts=c("contr.sum","contr.poly"))
m <- lm(Surface_Roughness ~ A*B*C*D,df4)
halfnormalplot(m$effects[2:16],label=T,l_pos=2)
qqline(m$effects[2:16])
```
\subsection{b}
The residual plot show a trend line, but there is no indication of non-constant variance. The normal QQ plot shows that the resiuals are not following the normal distribution.
```{r}
m <- lm(Surface_Roughness ~ A + B + C + A*B,df4)
anova(m)
plot(m,1:2)
```
\subsection{c}
The transformation eliminated the trend line that was present in the earlier untransformed analysis. It also made the residuals follow the normal distribution more closely.
```{r}
df4$Surface_Roughness_T <- 1/df4$Surface_Roughness
m <- lm(1/Surface_Roughness ~ A*B*C*D, df4)
halfnormalplot(m$effects[2:16],label=T,l_pos=2)
qqline(m$effects[2:16])

m <- lm(1/Surface_Roughness ~ A+B+C+A*B, df4)
anova(m)
plot(m,1:2)
```
\subsection{d}
$$\frac{1}{Surface \ Roughness} = 397.81 - 51.61 A - 74.74B -34.24 C+58.70AB$$
\section{6.45}
\section{7.14}








